<site name="Imgur" homepage="http://imgur.com/">
	<example>http://imgur.com/AsQ0K3P</example>
	<example>http://imgur.com/a/9UGCL</example>
	<example>http://imgur.com/gallery/9UGCL</example>
	<example>http://i.imgur.com/u7Yo0Vy.gifv</example>
	<example>http://i.imgur.com/UO1UrIx.mp4</example>

	<tags><tag>images</tag></tags>

	<attributes>
		<type type="alnum"/>
	</attributes>

	<host>imgur.com</host>
	<extract>!imgur\.com/(?:gallery/)?(?'id'(?:a/)?\w+)!</extract>
	<scrape>
		<match>!imgur\.com/(?:a|gallery)/\w!</match>
		<extract>!&lt;div id="(?'type'album)-!</extract>
		<extract>!class="(?'type'album)-image!</extract>
	</scrape>
	<scrape url="http://i.imgur.com/{@id}.gifv">
		<match>!imgur\.com/\w+\.(?:gifv|mp4|webm)!</match>
		<extract>!width:\s*(?'width'\d+)!</extract>
		<extract>!height:\s*(?'height'\d+)!</extract>
		<extract>!(?'type'gifv)!</extract>
	</scrape>

	<iframe>
		<width><![CDATA[
			<xsl:choose>
				<xsl:when test="@type='gifv' and @width"><xsl:value-of select="@width"/></xsl:when>
				<xsl:otherwise>100%</xsl:otherwise>
			</xsl:choose>
		]]></width>
		<height><![CDATA[
			<xsl:choose>
				<xsl:when test="@type='gifv' and @height"><xsl:value-of select="@height"/></xsl:when>
				<xsl:otherwise>550</xsl:otherwise>
			</xsl:choose>
		]]></height>
		<src><![CDATA[
			<xsl:choose>
				<xsl:when test="@type='gifv'">//i.imgur.com/<xsl:value-of select="@id"/>.gifv#embed</xsl:when>
				<xsl:when test="starts-with(@id,'a/')">//imgur.com/<xsl:value-of select="@id"/>/embed</xsl:when>
				<xsl:when test="@type='album'">//imgur.com/a/<xsl:value-of select="@id"/>/embed</xsl:when>
				<xsl:otherwise>//s9e.github.io/iframe/imgur.min.html#<xsl:value-of select="@id"/></xsl:otherwise>
			</xsl:choose>
		]]></src>
		<!--
			var id = Math.random();
			window.addEventListener('message', function(e)
			{
				// NOTE: e.data.id is a string whereas id is a number
				if (e.data.id == id)
				{
					style.height = e.data.height + 'px';
					style.width = e.data.width + 'px';
				}
			});

			var origin = src.substr(0, src.indexOf('/', 8));
			contentWindow.postMessage('s9e:' + id, origin);
		-->
		<onload><![CDATA[
			<xsl:if test="not(@type='gifv' or @type='album')">var b=Math.random();window.addEventListener('message',function(a){a.data.id==b&amp;&amp;(style.height=a.data.height+'px',style.width=a.data.width+'px')});contentWindow.postMessage('s9e:'+b,src.substr(0,src.indexOf('/',8)))</xsl:if>
		]]></onload>
	</iframe>
</site>